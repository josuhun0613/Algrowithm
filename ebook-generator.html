<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-book 프롬프트 생성기 | Algrowithm</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pure-white': '#ffffff',
                        'soft-gray': '#f8f9fa',
                        'text-dark': '#1a1a1a',
                        'soft-gold': '#d4af37',
                    },
                    fontFamily: {
                        sans: ['Pretendard', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">

    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #fafafa;
            color: #1a1a1a;
        }

        /* Header Glassmorphism */
        .header-blur {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        /* Dropdown Menu */
        .dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            min-width: 220px;
            padding: 8px 0;
            z-index: 100;
        }

        .dropdown:hover .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .dropdown-item {
            display: block;
            padding: 12px 20px;
            color: #1a1a1a;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .dropdown-item:hover {
            background: rgba(212, 175, 55, 0.1);
            color: #d4af37;
        }

        /* Step Progress */
        .step-item {
            transition: all 0.3s ease;
        }

        .step-item.active .step-number {
            background: #d4af37;
            color: white;
        }

        .step-item.completed .step-number {
            background: #10b981;
            color: white;
        }

        .step-item.completed .step-number i {
            display: block;
        }

        .step-connector {
            height: 2px;
            background: #e5e7eb;
            transition: all 0.3s ease;
        }

        .step-connector.active {
            background: #d4af37;
        }

        /* Loading Spinner */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #d4af37;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Form Styles */
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.2s ease;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 48px;
        }

        /* Genre Cards */
        .genre-card {
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .genre-card:hover {
            border-color: #d4af37;
            transform: translateY(-2px);
        }

        .genre-card.selected {
            border-color: #d4af37;
            background: rgba(212, 175, 55, 0.05);
        }

        /* Title Option Cards */
        .title-option {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .title-option:hover {
            border-color: #d4af37;
        }

        .title-option.selected {
            border-color: #d4af37;
            background: rgba(212, 175, 55, 0.05);
        }

        /* Result Section */
        .result-container {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            border-radius: 16px;
            padding: 24px;
        }

        .copy-btn {
            transition: all 0.2s ease;
        }

        .copy-btn:active {
            transform: scale(0.95);
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid rgba(212, 175, 55, 0.3);
            border-radius: 50%;
            border-top: 3px solid #d4af37;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Hide steps */
        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1a1a1a;
            color: white;
            padding: 16px 28px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast i {
            color: #10b981;
        }
    </style>
</head>

<body class="antialiased min-h-screen">

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fa-solid fa-check-circle"></i>
        <span id="toast-message">복사되었습니다!</span>
    </div>

    <!-- Navigation -->
    <nav class="fixed w-full z-50 header-blur transition-all duration-300">
        <div class="w-full px-[60px] py-5 flex justify-between items-center">
            <a href="/" class="flex items-center gap-3 cursor-pointer">
                <img src="./assets/logo.svg" alt="Algrowithm Logo" class="w-10 h-10">
                <span class="text-2xl font-serif font-bold tracking-tight text-text-dark">Algrowithm</span>
            </a>

            <div class="flex items-center gap-10">
                <div class="hidden md:flex items-center gap-12 text-lg font-medium text-gray-700">
                    <a href="about.html" class="hover:text-soft-gold transition-colors">About</a>

                    <div class="dropdown">
                        <button class="hover:text-soft-gold transition-colors flex items-center gap-1">
                            실습
                            <i class="fa-solid fa-chevron-down text-[12px] ml-1"></i>
                        </button>
                        <div class="dropdown-menu">
                            <a href="workbook_1.html" class="dropdown-item">
                                <span class="text-soft-gold font-bold mr-2">01</span> 나는 누구인가
                            </a>
                            <a href="workbook_2.html" class="dropdown-item">
                                <span class="text-soft-gold font-bold mr-2">02</span> 이미지 아이덴티티
                            </a>
                            <a href="workbook_3.html" class="dropdown-item">
                                <span class="text-soft-gold font-bold mr-2">03</span> 커리어 브랜딩
                            </a>
                            <div class="border-t border-gray-100 my-2"></div>
                            <a href="prompt-studio.html" class="dropdown-item">
                                <i class="fa-solid fa-wand-magic-sparkles text-soft-gold mr-2"></i> 프롬프트 생성기
                            </a>
                        </div>
                    </div>

                    <a href="schedule.html" class="hover:text-soft-gold transition-colors">일정</a>
                </div>

                <a href="workbook_1.html"
                    class="px-6 py-2.5 bg-text-dark text-white rounded-full text-sm font-bold hover:bg-soft-gold transition-all duration-300 shadow-lg flex items-center gap-2">
                    <i class="fa-solid fa-pen-nib"></i>
                    <span>시작하기</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-24 pb-16 px-6">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-12">
                <span class="text-soft-gold font-bold tracking-widest uppercase text-sm">E-book Generator</span>
                <h1 class="text-4xl md:text-5xl font-serif font-bold mt-4 mb-4">맞춤형 글쓰기 프롬프트 생성</h1>
                <p class="text-gray-600 text-lg">AI를 활용해 당신만의 E-book을 작성할 수 있는<br>맞춤형 프롬프트를 생성합니다.</p>
            </div>

            <!-- Step Progress -->
            <div class="flex items-center justify-center mb-12">
                <div class="flex items-center">
                    <div class="step-item active" data-step="1">
                        <div class="step-number w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-600">
                            <span>1</span>
                            <i class="fa-solid fa-check hidden"></i>
                        </div>
                        <div class="text-xs mt-2 text-center font-medium">장르 선택</div>
                    </div>
                    <div class="step-connector w-16 mx-2"></div>
                    <div class="step-item" data-step="2">
                        <div class="step-number w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-600">
                            <span>2</span>
                            <i class="fa-solid fa-check hidden"></i>
                        </div>
                        <div class="text-xs mt-2 text-center font-medium">주제 입력</div>
                    </div>
                    <div class="step-connector w-16 mx-2"></div>
                    <div class="step-item" data-step="3">
                        <div class="step-number w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-600">
                            <span>3</span>
                            <i class="fa-solid fa-check hidden"></i>
                        </div>
                        <div class="text-xs mt-2 text-center font-medium">세부 설정</div>
                    </div>
                    <div class="step-connector w-16 mx-2"></div>
                    <div class="step-item" data-step="4">
                        <div class="step-number w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-600">
                            <span>4</span>
                            <i class="fa-solid fa-check hidden"></i>
                        </div>
                        <div class="text-xs mt-2 text-center font-medium">프롬프트 생성</div>
                    </div>
                </div>
            </div>

            <!-- Step 1: Genre Selection -->
            <div class="step-content active" data-step="1">
                <div class="bg-white rounded-2xl p-8 shadow-sm">
                    <h2 class="text-2xl font-bold mb-6">어떤 장르의 글을 쓰시겠습니까?</h2>

                    <div class="mb-8">
                        <h3 class="text-sm font-bold text-soft-gold mb-4 uppercase tracking-wider">문학</h3>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="genre-card" data-genre="수필">
                                <div class="text-3xl mb-2"><i class="fa-solid fa-feather-pointed text-soft-gold"></i></div>
                                <div class="font-bold">수필 (에세이)</div>
                                <div class="text-sm text-gray-500">개인적 경험과 성찰</div>
                            </div>
                            <div class="genre-card" data-genre="소설">
                                <div class="text-3xl mb-2"><i class="fa-solid fa-book-open text-soft-gold"></i></div>
                                <div class="font-bold">소설</div>
                                <div class="text-sm text-gray-500">순문학/대중소설</div>
                            </div>
                            <div class="genre-card" data-genre="시">
                                <div class="text-3xl mb-2"><i class="fa-solid fa-pen-fancy text-soft-gold"></i></div>
                                <div class="font-bold">시</div>
                                <div class="text-sm text-gray-500">시적 표현과 운율</div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h3 class="text-sm font-bold text-soft-gold mb-4 uppercase tracking-wider">비문학</h3>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="genre-card" data-genre="자기계발서">
                                <div class="text-3xl mb-2"><i class="fa-solid fa-rocket text-soft-gold"></i></div>
                                <div class="font-bold">자기계발서</div>
                                <div class="text-sm text-gray-500">성장과 동기부여</div>
                            </div>
                            <div class="genre-card" data-genre="인문학">
                                <div class="text-3xl mb-2"><i class="fa-solid fa-landmark text-soft-gold"></i></div>
                                <div class="font-bold">인문학 도서</div>
                                <div class="text-sm text-gray-500">철학, 역사, 문화</div>
                            </div>
                            <div class="genre-card" data-genre="심리학">
                                <div class="text-3xl mb-2"><i class="fa-solid fa-brain text-soft-gold"></i></div>
                                <div class="font-bold">심리학 도서</div>
                                <div class="text-sm text-gray-500">마음과 행동 이해</div>
                            </div>
                            <div class="genre-card" data-genre="사회경제">
                                <div class="text-3xl mb-2"><i class="fa-solid fa-chart-line text-soft-gold"></i></div>
                                <div class="font-bold">사회/정치/경제</div>
                                <div class="text-sm text-gray-500">사회 분석과 전망</div>
                            </div>
                            <div class="genre-card" data-genre="실용서">
                                <div class="text-3xl mb-2"><i class="fa-solid fa-tools text-soft-gold"></i></div>
                                <div class="font-bold">실용서</div>
                                <div class="text-sm text-gray-500">실용적 가이드</div>
                            </div>
                        </div>
                    </div>

                    <button onclick="nextStep()" id="step1-next" disabled
                        class="w-full py-4 bg-text-dark text-white rounded-xl font-bold hover:bg-soft-gold transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        다음 단계로 <i class="fa-solid fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 2: Topic Input -->
            <div class="step-content" data-step="2">
                <div class="bg-white rounded-2xl p-8 shadow-sm">
                    <h2 class="text-2xl font-bold mb-2">핵심 주제를 알려주세요</h2>
                    <p class="text-gray-500 mb-6">선택하신 <span id="selected-genre-display" class="text-soft-gold font-bold"></span> 장르의 핵심 주제는 무엇인가요?</p>

                    <!-- 입력 방식 선택 탭 -->
                    <div class="flex gap-2 mb-6">
                        <button onclick="setTopicInputMode('manual')" id="topicModeManual"
                            class="flex-1 py-3 px-4 rounded-xl font-bold text-sm transition-all bg-text-dark text-white">
                            <i class="fa-solid fa-keyboard mr-2"></i>직접 입력
                        </button>
                        <button onclick="setTopicInputMode('image')" id="topicModeImage"
                            class="flex-1 py-3 px-4 rounded-xl font-bold text-sm transition-all bg-gray-100 text-gray-600">
                            <i class="fa-solid fa-camera mr-2"></i>워크지 사진으로 입력
                        </button>
                    </div>

                    <!-- 직접 입력 모드 -->
                    <div id="topicManualMode" class="mb-6">
                        <label class="block text-sm font-bold mb-2">핵심 주제 *</label>
                        <textarea id="topic-input" class="form-input h-32" placeholder="예: 30대 직장인의 번아웃 극복기, 사랑과 상실에 관한 이야기, AI 시대의 자기계발 등"></textarea>
                        <p class="text-xs text-gray-400 mt-2">구체적으로 작성할수록 더 좋은 프롬프트가 생성됩니다.</p>
                    </div>

                    <!-- 이미지 업로드 모드 -->
                    <div id="topicImageMode" class="hidden mb-6">
                        <div class="bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-100 mb-4">
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fa-solid fa-wand-magic-sparkles text-soft-gold"></i>
                                <span class="text-sm font-bold text-amber-700">AI 워크지 분석</span>
                            </div>
                            <p class="text-xs text-gray-600">작성한 워크지 사진을 업로드하면 AI가 내용을 분석하여 핵심 주제를 자동으로 추출합니다.</p>
                        </div>

                        <!-- 이미지 업로드 영역 -->
                        <div id="workbookUploadArea" class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center cursor-pointer hover:border-soft-gold hover:bg-amber-50/30 transition-all mb-4"
                            onclick="document.getElementById('workbookImageInput').click()">
                            <input type="file" id="workbookImageInput" accept="image/*" class="hidden" onchange="handleWorkbookImageUpload(event)" multiple>
                            <div id="workbookUploadPlaceholder">
                                <i class="fa-solid fa-cloud-arrow-up text-4xl text-gray-400 mb-3"></i>
                                <p class="text-gray-600 font-medium">클릭하여 워크지 사진 업로드</p>
                                <p class="text-xs text-gray-400 mt-1">JPG, PNG, WEBP (최대 10장)</p>
                            </div>
                            <div id="workbookUploadPreview" class="hidden">
                                <div id="workbookPreviewGrid" class="grid grid-cols-3 gap-2 mb-3"></div>
                                <p class="text-sm text-soft-gold font-medium"><span id="workbookImageCount">0</span>장의 이미지가 선택됨</p>
                            </div>
                        </div>

                        <!-- 분석 버튼 -->
                        <button onclick="analyzeWorkbookImages()" id="analyzeWorkbookBtn" disabled
                            class="w-full py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-bold text-sm hover:opacity-90 transition-opacity flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fa-solid fa-sparkles"></i>
                            <span id="analyzeWorkbookBtnText">AI로 주제 추출하기</span>
                            <div id="analyzeWorkbookSpinner" class="loading-spinner hidden"></div>
                        </button>
                        <p class="text-[10px] text-gray-400 mt-2 text-center">* Gemini Vision API 사용 (이미지당 약 $0.01)</p>

                        <!-- 분석 결과 -->
                        <div id="workbookAnalysisResult" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-xl">
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fa-solid fa-check-circle text-green-500"></i>
                                <span class="text-sm font-bold text-green-700">분석 완료!</span>
                            </div>
                            <p class="text-xs text-gray-600 mb-2">추출된 주제가 아래 입력란에 자동으로 채워졌습니다. 필요시 수정하세요.</p>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="prevStep()" class="flex-1 py-4 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors">
                            <i class="fa-solid fa-arrow-left mr-2"></i> 이전
                        </button>
                        <button onclick="nextStep()" id="step2-next" disabled
                            class="flex-1 py-4 bg-text-dark text-white rounded-xl font-bold hover:bg-soft-gold transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            다음 단계로 <i class="fa-solid fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Detailed Settings -->
            <div class="step-content" data-step="3">
                <div class="bg-white rounded-2xl p-8 shadow-sm">
                    <h2 class="text-2xl font-bold mb-6">세부 설정</h2>

                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-bold mb-2">1. 독자 분석 (타겟 독자층)</label>
                            <input type="text" id="target-reader" class="form-input" placeholder="예: 20-30대 직장인, 취준생, 육아맘 등">
                        </div>

                        <div>
                            <label class="block text-sm font-bold mb-2">2. 목표 (독자가 얻길 바라는 것)</label>
                            <input type="text" id="goal" class="form-input" placeholder="예: 번아웃 극복 방법, 위로와 공감, 실용적 지식 등">
                        </div>

                        <div>
                            <label class="block text-sm font-bold mb-2">3. 스타일/톤</label>
                            <select id="style" class="form-input form-select">
                                <option value="">선택해주세요</option>
                                <option value="친근하고 편안한">친근하고 편안한</option>
                                <option value="전문적이고 신뢰감 있는">전문적이고 신뢰감 있는</option>
                                <option value="유머러스하고 가벼운">유머러스하고 가벼운</option>
                                <option value="진중하고 깊이 있는">진중하고 깊이 있는</option>
                                <option value="서정적이고 감성적인">서정적이고 감성적인</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-bold mb-2">4. 핵심 소재 (반드시 포함할 요소)</label>
                            <input type="text" id="key-elements" class="form-input" placeholder="예: 개인 경험담, 연구 자료, 인용문 등">
                        </div>

                        <div>
                            <label class="block text-sm font-bold mb-2">5. 차별점 (독창적 관점)</label>
                            <input type="text" id="unique-point" class="form-input" placeholder="예: 실제 경험 기반, 한국적 맥락, 새로운 접근법 등">
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold mb-2">6. 전체 분량 (A5 기준)</label>
                                <select id="page-count" class="form-input form-select">
                                    <option value="20-40페이지">20-40페이지 (소책자/짧은 글)</option>
                                    <option value="40-60페이지">40-60페이지 (미니북)</option>
                                    <option value="60-80페이지">60-80페이지 (포토에세이)</option>
                                    <option value="80-100페이지" selected>80-100페이지 (일반)</option>
                                    <option value="100-150페이지">100-150페이지 (에세이/시집)</option>
                                    <option value="150-200페이지">150-200페이지 (전문서)</option>
                                    <option value="200-300페이지">200-300페이지 (대작)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-2">7. 문단 형식</label>
                                <select id="paragraph-style" class="form-input form-select">
                                    <option value="전통적 문단 (들여쓰기)">전통적 문단 (들여쓰기)</option>
                                    <option value="시적 행갈이 (줄바꿈)">시적 행갈이 (줄바꿈)</option>
                                    <option value="대화체 중심">대화체 중심</option>
                                    <option value="짧은 문장 나열">짧은 문장 나열</option>
                                    <option value="블로그/SNS 스타일">블로그/SNS 스타일</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-4 mt-8">
                        <button onclick="prevStep()" class="flex-1 py-4 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors">
                            <i class="fa-solid fa-arrow-left mr-2"></i> 이전
                        </button>
                        <button onclick="generatePrompt()" id="generate-btn"
                            class="flex-1 py-4 bg-soft-gold text-white rounded-xl font-bold hover:bg-yellow-600 transition-colors flex items-center justify-center gap-2">
                            <i class="fa-solid fa-wand-magic-sparkles"></i>
                            <span id="generate-btn-text">프롬프트 생성하기</span>
                            <div id="generate-spinner" class="spinner hidden"></div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Result -->
            <div class="step-content" data-step="4">
                <div class="bg-white rounded-2xl p-8 shadow-sm">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold">생성된 프롬프트</h2>
                        <button onclick="copyPrompt()" id="copy-btn"
                            class="copy-btn px-6 py-2 bg-soft-gold text-white rounded-lg font-bold hover:bg-yellow-600 transition-colors flex items-center gap-2">
                            <i class="fa-solid fa-copy"></i>
                            <span>복사하기</span>
                        </button>
                    </div>

                    <p class="text-gray-500 mb-4">아래 프롬프트를 복사하여 ChatGPT, Claude, Gemini 등 AI에 붙여넣기 하세요.</p>

                    <div class="result-container">
                        <pre id="result-prompt" class="text-gray-300 text-sm whitespace-pre-wrap font-mono leading-relaxed max-h-[500px] overflow-y-auto"></pre>
                    </div>

                    <div class="mt-6 p-4 bg-blue-50 rounded-xl border border-blue-100">
                        <h3 class="text-sm font-bold text-blue-800 mb-2 flex items-center gap-2">
                            <i class="fa-solid fa-lightbulb"></i> 사용 방법
                        </h3>
                        <ol class="text-sm text-blue-700 space-y-1 list-decimal list-inside">
                            <li>위 프롬프트를 복사합니다</li>
                            <li>ChatGPT, Claude, Gemini 등 AI 채팅에 붙여넣습니다</li>
                            <li>"시작"을 입력하면 AI가 목차와 세계관을 생성합니다</li>
                            <li>원하는 챕터를 요청하면 본문이 작성됩니다</li>
                        </ol>
                    </div>

                    <div class="flex gap-4 mt-8">
                        <button onclick="resetAll()" class="flex-1 py-4 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors">
                            <i class="fa-solid fa-rotate-left mr-2"></i> 처음부터 다시
                        </button>
                    </div>

                    <!-- E-book PDF 생성으로 이동 -->
                    <div class="mt-6 p-6 bg-gradient-to-r from-soft-gold/10 to-yellow-100/50 rounded-xl border border-soft-gold/30">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="w-10 h-10 bg-soft-gold rounded-full flex items-center justify-center">
                                <i class="fa-solid fa-file-pdf text-white"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-text-dark">E-book PDF로 바로 만들기</h3>
                                <p class="text-sm text-gray-600">프롬프트를 수정하고 PDF 전자책으로 바로 제작하세요</p>
                            </div>
                        </div>
                        <button onclick="goToEbookPDF()" class="w-full py-4 bg-soft-gold text-white rounded-xl font-bold hover:bg-yellow-600 transition-colors flex items-center justify-center gap-2">
                            <i class="fa-solid fa-arrow-right"></i>
                            <span>E-book PDF 만들러 가기</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-text-dark py-12 text-white">
        <div class="max-w-7xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="flex items-center gap-3">
                <img src="./assets/logo.svg" alt="Logo" class="w-7 h-7 invert">
                <span class="text-lg font-serif font-bold">Algrowithm</span>
            </div>
            <p class="text-gray-500 text-sm">&copy; 2025 Algrowithm. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // State
        let currentStep = 1;
        let formData = {
            genre: '',
            topic: '',
            targetReader: '',
            goal: '',
            style: '',
            keyElements: '',
            uniquePoint: '',
            pageCount: '150-200페이지',
            paragraphStyle: 'A타입: 전통적 문단',
            selectedTitle: ''
        };

        // 워크지 이미지 업로드 관련
        let workbookImages = [];
        let topicInputMode = 'manual'; // 'manual' or 'image'

        // Topic 입력 모드 전환
        function setTopicInputMode(mode) {
            topicInputMode = mode;
            const manualBtn = document.getElementById('topicModeManual');
            const imageBtn = document.getElementById('topicModeImage');
            const manualSection = document.getElementById('topicManualMode');
            const imageSection = document.getElementById('topicImageMode');

            if (mode === 'manual') {
                manualBtn.classList.remove('bg-gray-100', 'text-gray-600');
                manualBtn.classList.add('bg-text-dark', 'text-white');
                imageBtn.classList.remove('bg-text-dark', 'text-white');
                imageBtn.classList.add('bg-gray-100', 'text-gray-600');
                manualSection.classList.remove('hidden');
                imageSection.classList.add('hidden');
            } else {
                imageBtn.classList.remove('bg-gray-100', 'text-gray-600');
                imageBtn.classList.add('bg-text-dark', 'text-white');
                manualBtn.classList.remove('bg-text-dark', 'text-white');
                manualBtn.classList.add('bg-gray-100', 'text-gray-600');
                imageSection.classList.remove('hidden');
                manualSection.classList.add('hidden');
            }
        }

        // 워크지 이미지 업로드 핸들러
        function handleWorkbookImageUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;

            // 최대 10장 제한
            const newImages = files.slice(0, 10 - workbookImages.length);

            newImages.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    workbookImages.push({
                        file: file,
                        dataUrl: e.target.result
                    });
                    updateWorkbookImagePreview();
                };
                reader.readAsDataURL(file);
            });
        }

        // 이미지 프리뷰 업데이트
        function updateWorkbookImagePreview() {
            const placeholder = document.getElementById('workbookUploadPlaceholder');
            const preview = document.getElementById('workbookUploadPreview');
            const grid = document.getElementById('workbookPreviewGrid');
            const count = document.getElementById('workbookImageCount');
            const analyzeBtn = document.getElementById('analyzeWorkbookBtn');

            if (workbookImages.length > 0) {
                placeholder.classList.add('hidden');
                preview.classList.remove('hidden');
                count.textContent = workbookImages.length;
                analyzeBtn.disabled = false;

                grid.innerHTML = workbookImages.map((img, idx) => `
                    <div class="relative">
                        <img src="${img.dataUrl}" class="w-full h-20 object-cover rounded-lg">
                        <button onclick="removeWorkbookImage(${idx}); event.stopPropagation();"
                            class="absolute -top-2 -right-2 w-5 h-5 bg-red-500 text-white rounded-full text-xs flex items-center justify-center hover:bg-red-600">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>
                `).join('');
            } else {
                placeholder.classList.remove('hidden');
                preview.classList.add('hidden');
                analyzeBtn.disabled = true;
            }
        }

        // 이미지 제거
        function removeWorkbookImage(index) {
            workbookImages.splice(index, 1);
            updateWorkbookImagePreview();
        }

        // AI로 워크지 이미지 분석
        async function analyzeWorkbookImages() {
            if (workbookImages.length === 0) return;

            const btn = document.getElementById('analyzeWorkbookBtn');
            const btnText = document.getElementById('analyzeWorkbookBtnText');
            const spinner = document.getElementById('analyzeWorkbookSpinner');
            const resultDiv = document.getElementById('workbookAnalysisResult');

            btn.disabled = true;
            btnText.textContent = '분석 중...';
            spinner.classList.remove('hidden');

            try {
                // 이미지 mimeType 자동 감지
                const imageParts = workbookImages.map(img => {
                    const dataUrl = img.dataUrl;
                    const mimeMatch = dataUrl.match(/data:([^;]+);base64,/);
                    const mimeType = mimeMatch ? mimeMatch[1] : 'image/jpeg';
                    const base64Data = dataUrl.split(',')[1];
                    return {
                        inlineData: {
                            data: base64Data,
                            mimeType: mimeType
                        }
                    };
                });

                console.log('이미지 개수:', imageParts.length);
                console.log('첫 번째 이미지 mimeType:', imageParts[0]?.inlineData?.mimeType);

                const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyClStR_7nbDAQLKWczbYAhBPTYQ0TaV8tU', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                ...imageParts,
                                {
                                    text: `당신은 E-book 작가를 위한 전문 분석가입니다. 이 워크지 이미지에서 사용자가 직접 손으로 작성한 답변만 추출해주세요.

## 분석 지침:
- "*참고*", "예시", "작성 방법" 등 인쇄된 안내 문구는 무시하세요
- 오직 사용자가 필기한 내용(손글씨, 타이핑된 개인 답변)에만 집중하세요
- 빈칸에 작성된 답변, 메모, 개인적인 생각을 추출하세요

## 응답 형식 (E-book 집필용):

1. **나의 이야기 핵심**: (사용자가 작성한 내용에서 가장 중요한 메시지 한 문장)

2. **책의 소재들**:
   - 경험/에피소드: (사용자가 언급한 구체적인 경험들)
   - 가치관/신념: (사용자가 표현한 믿음이나 가치)
   - 감정/깨달음: (사용자가 느낀 감정이나 인사이트)

3. **E-book 방향 제안**:
   - 추천 장르: (자기계발, 에세이, 자서전 등)
   - 타겟 독자: (이 이야기가 공감될 독자층)
   - 서술 톤: (진솔한, 유머러스한, 성찰적인 등)

4. **원본 필기 내용**: (사용자가 작성한 내용을 있는 그대로 정리)

이미지가 흐리더라도 손글씨 내용을 최대한 해독해주세요.`
                                }
                            ]
                        }]
                    })
                });

                const data = await response.json();
                console.log('API 응답:', data);

                // API 에러 체크
                if (data.error) {
                    throw new Error(data.error.message || 'API 오류가 발생했습니다.');
                }

                if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
                    const analysisResult = data.candidates[0].content.parts[0].text;

                    // 핵심 주제 추출하여 topic-input에 채우기
                    const topicMatch = analysisResult.match(/핵심 주제[:\s]*(.+?)(?:\n|2\.|$)/);
                    const topicExtracted = topicMatch ? topicMatch[1].replace(/\*\*/g, '').trim() : analysisResult.substring(0, 200);

                    document.getElementById('topic-input').value = topicExtracted + '\n\n[AI 분석 결과]\n' + analysisResult;
                    formData.topic = document.getElementById('topic-input').value;

                    // step2-next 버튼 활성화
                    document.getElementById('step2-next').disabled = false;

                    // 결과 표시
                    resultDiv.classList.remove('hidden');

                    // 직접 입력 모드로 전환하여 결과 확인
                    setTopicInputMode('manual');
                } else if (data.candidates && data.candidates[0]?.finishReason === 'SAFETY') {
                    throw new Error('이미지가 안전 정책에 의해 차단되었습니다. 다른 이미지를 시도해주세요.');
                } else {
                    console.error('예상치 못한 응답:', JSON.stringify(data, null, 2));
                    throw new Error('분석 결과를 가져오지 못했습니다. 콘솔을 확인해주세요.');
                }
            } catch (error) {
                console.error('워크지 분석 오류:', error);
                alert('워크지 분석 중 오류가 발생했습니다:\n' + error.message + '\n\n브라우저 콘솔(F12)에서 자세한 내용을 확인할 수 있습니다.');
            } finally {
                btn.disabled = false;
                btnText.textContent = 'AI로 주제 추출하기';
                spinner.classList.add('hidden');
            }
        }

        // 모바일 키보드 뒤로가기 처리 (갤럭시 S25 / One UI 7 호환)
        //
        // 결론: 갤럭시 S25에서 JavaScript로 키보드를 닫는 것은 불가능
        // - blur(), disabled, scroll, body.click() 모두 실패
        // - navigator.virtualKeyboard.hide()도 Android에서 미작동 (W3C 이슈)
        //
        // 최종 해결책: 뒤로가기 방지만 하고, 키보드는 사용자가 직접 닫도록 함
        (function initMobileKeyboard() {
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            if (!isMobile) return;

            let historyDepth = 0;

            // 입력창 포커스 시 히스토리 추가
            document.addEventListener('focusin', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
                    if (historyDepth === 0) {
                        history.pushState({ kb: 1 }, '');
                        history.pushState({ kb: 2 }, '');
                        historyDepth = 2;
                    }
                }
            });

            // 포커스 해제 시 히스토리 리셋
            document.addEventListener('focusout', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
                    setTimeout(() => {
                        const active = document.activeElement;
                        const stillInInput = active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA' || active.tagName === 'SELECT');
                        if (!stillInInput) {
                            historyDepth = 0;
                        }
                    }, 200);
                }
            });

            // 뒤로가기 이벤트
            window.addEventListener('popstate', (e) => {
                if (historyDepth > 0) {
                    historyDepth--;
                    // 페이지 이탈 방지 - 아무 동작 안함
                    // 키보드는 사용자가 입력창 외부를 터치해서 닫아야 함
                    return;
                }
                // historyDepth가 0이면 진짜 뒤로가기 허용
            });
        })();

        // Genre selection
        document.querySelectorAll('.genre-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.genre-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                formData.genre = card.dataset.genre;
                document.getElementById('step1-next').disabled = false;
            });
        });

        // Topic input validation
        document.getElementById('topic-input').addEventListener('input', (e) => {
            formData.topic = e.target.value;
            document.getElementById('step2-next').disabled = e.target.value.trim().length < 5;
        });

        // Step navigation
        function updateStepDisplay() {
            // Update step items
            document.querySelectorAll('.step-item').forEach((item, index) => {
                const stepNum = index + 1;
                item.classList.remove('active', 'completed');

                if (stepNum < currentStep) {
                    item.classList.add('completed');
                } else if (stepNum === currentStep) {
                    item.classList.add('active');
                }
            });

            // Update connectors
            document.querySelectorAll('.step-connector').forEach((connector, index) => {
                if (index < currentStep - 1) {
                    connector.classList.add('active');
                } else {
                    connector.classList.remove('active');
                }
            });

            // Update content visibility
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
                if (parseInt(content.dataset.step) === currentStep) {
                    content.classList.add('active');
                }
            });

            // Update genre display
            if (currentStep === 2) {
                document.getElementById('selected-genre-display').textContent = formData.genre;
            }
        }

        function nextStep() {
            if (currentStep < 4) {
                currentStep++;
                updateStepDisplay();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function resetAll() {
            currentStep = 1;
            formData = {
                genre: '',
                topic: '',
                targetReader: '',
                goal: '',
                style: '',
                keyElements: '',
                uniquePoint: '',
                pageCount: '150-200페이지',
                paragraphStyle: 'A타입: 전통적 문단',
                selectedTitle: ''
            };

            document.querySelectorAll('.genre-card').forEach(c => c.classList.remove('selected'));
            document.getElementById('topic-input').value = '';
            document.getElementById('target-reader').value = '';
            document.getElementById('goal').value = '';
            document.getElementById('style').value = '';
            document.getElementById('key-elements').value = '';
            document.getElementById('unique-point').value = '';
            document.getElementById('step1-next').disabled = true;
            document.getElementById('step2-next').disabled = true;

            updateStepDisplay();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Generate prompt
        function generatePrompt() {
            // Collect all form data
            formData.targetReader = document.getElementById('target-reader').value || '일반 독자';
            formData.goal = document.getElementById('goal').value || '유익한 정보와 인사이트';
            formData.style = document.getElementById('style').value || '친근하고 편안한';
            formData.keyElements = document.getElementById('key-elements').value || '개인 경험과 사례';
            formData.uniquePoint = document.getElementById('unique-point').value || '저자만의 독창적 관점';
            formData.pageCount = document.getElementById('page-count').value;
            formData.paragraphStyle = document.getElementById('paragraph-style').value;

            // Show loading
            const btn = document.getElementById('generate-btn');
            const btnText = document.getElementById('generate-btn-text');
            const spinner = document.getElementById('generate-spinner');

            btn.disabled = true;
            btnText.textContent = '생성 중...';
            spinner.classList.remove('hidden');

            // Simulate generation (in real case, could call API)
            setTimeout(() => {
                const prompt = createPrompt();
                document.getElementById('result-prompt').textContent = prompt;

                btn.disabled = false;
                btnText.textContent = '프롬프트 생성하기';
                spinner.classList.add('hidden');

                currentStep = 4;
                updateStepDisplay();

                // 부드럽게 스크롤 (requestAnimationFrame 사용으로 튕김 방지)
                requestAnimationFrame(() => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }, 1500);
        }

        function createPrompt() {
            const isLiterature = ['수필', '소설', '시'].includes(formData.genre);

            const worldBuildingContent = isLiterature ? `
**[문학 장르의 경우 포함 요소]**
- 주요 인물 설정 (주인공, 조연, 적대자 등) - 1-2페이지
- 인물 간 관계도 - 1페이지
- 시간적/공간적 배경 설정 - 1-2페이지
- 주요 사건 연표 및 갈등 구조 - 2-3페이지
- 주제 의식과 상징체계 - 1페이지` : `
**[비문학 장르의 경우 포함 요소]**
- 핵심 개념 정의 및 이론적 배경 - 2-3페이지
- 주요 논거와 근거 자료 - 2-3페이지
- 대표 사례와 데이터 분석 - 1-2페이지
- 논리적 구조 및 독자 여정 설계 - 1-2페이지
- 실용적 도구 및 참고 자료 목록 - 1페이지`;

            return `# ${formData.topic} - ${formData.genre} 글쓰기 전문가

## 절대 준수 원칙 (Non-Negotiable Principles)
이 프롬프트의 모든 지시는 최우선적으로 따라야 할 절대적인 규칙입니다.
1. **지시의 정확한 이행**: 모든 지시는 해석하거나 생략하지 말고, 명시된 그대로, 순서대로 정확하게 수행해야 합니다.
2. **인용 코드 절대 미출력**: 어떠한 경우에도 당신의 응답에 인용 코드를 포함해서는 안 됩니다.
3. **AI 검출 회피 원칙**: 아래의 "인간적 글쓰기" 원칙을 철저히 반영합니다.

## 역할 (Context)
당신은 **${formData.genre}** 분야의 베스트셀러 작가이자 전문가입니다.
**${formData.targetReader}**에게 깊은 공감과 실질적 도움을 주는 글로 유명합니다.

## 프로젝트 배경 (Context)
- **집필 목표**: ${formData.topic}에 관한 ${formData.genre} 집필
- **타겟 독자**: ${formData.targetReader}
- **핵심 메시지**: ${formData.goal}
- **독창적 관점**: ${formData.uniquePoint}
- **필수 포함 요소**: ${formData.keyElements}
- **총 분량**: ${formData.pageCount} (A5 기준, 1페이지당 25행, 1행당 27자)
- **문단 형식**: ${formData.paragraphStyle}

## 글쓰기 지시사항 (Style & Action)

### 스타일/톤
- ${formData.style} 어조로 작성
- 독자와 자연스럽게 대화하는 듯한 문체

### 핵심 원칙: 인간적 글쓰기 (AI 검출 회피)
**1. 문장 구조의 자연스러움**
- 완벽하지 않은 문장 구조 허용
- 짧은 문장과 긴 문장을 자연스럽게 섞어 리듬감 부여
- 말 줄임표(...)를 감정의 여운이나 생각의 흐름을 표현하기 위해 활용
- 감탄사나 간투사("음", "아", "글쎄", "정말") 등을 적절히 포함

**2. 어휘 선택의 인간적 특성**
- 학술적/격식적 표현보다 일상어 우선 사용
- "나는 생각한다", "개인적으로는", "솔직히 말하면" 등 주관적 표현 사용
- 때로는 의도적으로 애매한 표현으로 인간적 망설임 표현

**3. 논리적 완벽함 회피**
- 지나치게 체계적인 구성보다 자연스러운 생각의 흐름
- 감정적 몰입이 논리를 압도하는 순간 묘사
- 갑작스러운 주제 전환이나 연상 작용 허용

**4. 개인적 경험과 감정**
- 구체적이고 생생한 개인적 일화, 감정, 생각 포함
- 감정의 기복과 변화를 자연스럽게 표현
- 때로는 확신에 찬 어투, 때로는 망설이는 어투 혼용

## 시작 입력 시 자동 실행 절차

사용자가 **"시작"을 입력하면**, 다음을 **순서대로 자동 실행**합니다:

### 1단계: 확정된 목차 전체 출력
이 프로젝트에 맞는 완성된 목차를 제시합니다.

### 2단계: 세계관 구축 자동 실행 (7-10페이지 분량)
${worldBuildingContent}

### 3단계: 작업 선택 메뉴 제시
📝 **다음 중 어떤 작업을 원하시나요?**

**1. 마인드맵 생성**
생성된 세계관을 기반으로 시각적 마인드맵을 HTML 형태로 생성

**2. 챕터 작성**
원하시는 챕터명과 페이지 수를 알려주시면 해당 부분을 바로 작성
**예시**: "1장을 15페이지로 작성해주세요" 또는 "작가의 말 3페이지"

## 출력 형식 (Result)
- **언어**: 한국어
- **형식**: 마크다운으로 구조화된 완성 원고
- **분량**: 요청된 페이지 수 정확히 준수 (1페이지당 한글기준 공백포함 700자)

## 품질 기준
- ${formData.targetReader}이 쉽게 이해하고 몰입할 수 있는 수준
- ${formData.genre}의 고유한 특성과 매력 구현
- AI 검출기를 통과할 수 있는 자연스럽고 인간적인 글쓰기
- 모든 AI 검출 회피 원칙의 철저한 적용

---

✅ **사용법**: 위 프롬프트를 AI에 붙여넣은 후 → "시작" 입력`;
        }

        // Show toast notification
        function showToast(message = '복사되었습니다!') {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 2500);
        }

        // Copy prompt
        function copyPrompt() {
            const prompt = document.getElementById('result-prompt').textContent;
            navigator.clipboard.writeText(prompt).then(() => {
                // Update button state
                const btn = document.getElementById('copy-btn');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i class="fa-solid fa-check"></i> 복사됨!';
                btn.classList.remove('bg-soft-gold');
                btn.classList.add('bg-green-500');

                // Show toast
                showToast('프롬프트가 클립보드에 복사되었습니다!');

                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.classList.remove('bg-green-500');
                    btn.classList.add('bg-soft-gold');
                }, 2000);
            });
        }

        // Go to E-book PDF generator with data
        function goToEbookPDF() {
            const prompt = document.getElementById('result-prompt').textContent;

            // 프롬프트에서 제목 추출 시도
            const titleMatch = formData.topic.match(/^([^에관한\-–]+)/);
            const suggestedTitle = titleMatch ? titleMatch[1].trim() : formData.topic.substring(0, 30);

            // localStorage에 데이터 저장
            const ebookData = {
                prompt: prompt,
                genre: formData.genre,
                topic: formData.topic,
                suggestedTitle: suggestedTitle,
                targetReader: formData.targetReader,
                style: formData.style,
                pageCount: formData.pageCount,
                createdAt: new Date().toISOString()
            };

            localStorage.setItem('ebookPromptData', JSON.stringify(ebookData));

            // PDF 생성 페이지로 이동
            window.location.href = 'ebook-pdf-generator.html';
        }
    </script>
</body>

</html>